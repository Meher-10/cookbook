<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cookbook Videos</title>
  <link rel="stylesheet" href="../static/displayvideo.css">
</head>
<body>
  <div class="container">
    <h1>Cookbook Videos</h1>
    <div class="video-player" id="videoPlayer"></div>
    <div class="video-list" id="videoList"></div>
  </div>
  <!-- <script src="../static/js/displayvideo.js"></script> -->
  

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
  loadVideos();
});

function loadVideos() {
  $(document).ready(function () {
    $.get('/display', {})
    .done(function (data) {
        displayVideoPlayer(data[Object.keys(data)[0]]);
        displayVideoList(data);
    })
    .fail(function (error) {
        console.error('Error fetching videos:', error);
    });
});
}

function displayVideoPlayer(video) {
  const videoPlayer = document.getElementById('videoPlayer');
  const videoBlob = base64ToBlob(video.video_data);
  const videoBlobUrl = URL.createObjectURL(videoBlob);
  videoPlayer.innerHTML = `
    <video width="100%" height="100%" controls>
      <source src="${videoBlobUrl}" type="video/mp4">
    </video>
    <h2>${video.title}</h2>
    <p>${video.description}</p>
  `;
}

function displayVideoList(videos) {
  const videoList = document.getElementById('videoList');
  videoList.innerHTML = '';
  

  if(Object.keys(videos).length > 1){
    for (i in videos) {
      if (Object.keys(videos)[0]===i){
    continue}

    const videoElement = document.createElement('video');
    videoElement.setAttribute('width', '100%');
    videoElement.setAttribute('height', 'auto');
    videoElement.setAttribute('controls', 'controls');

    const sourceElement = document.createElement('source');
    sourceElement.setAttribute('src', URL.createObjectURL(base64ToBlob(videos[i].video_data)));
    sourceElement.setAttribute('type', 'video/mp4');

    videoElement.appendChild(sourceElement);
    videoList.appendChild(videoElement);
    

  }
  }
}

function base64ToBlob(base64String) {
  const raw = window.atob(base64String);
  const rawLength = raw.length;
  const uInt8Array = new Uint8Array(rawLength);
  for (let i = 0; i < rawLength; ++i) {
    uInt8Array[i] = raw.charCodeAt(i);
  }
  return new Blob([uInt8Array], { type: 'video/mp4' });
}


    </script>


</body>
</html>